{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap ea56276731e98c9653df","webpack:///./js/utils/constants.js","webpack:///./js/utils/canvas.js","webpack:///./node_modules/hyperapp/src/index.js","webpack:///./js/utils/animation.js","webpack:///./js/connection/adapter.js","webpack:///./js/connection/connection.js","webpack:///./js/connection/maintainer.js","webpack:///./js/utils/events.js","webpack:///./js/city/traffic/car/Car.js","webpack:///./js/ui/actions.js","webpack:///./js/ui/events.js","webpack:///./js/index.js","webpack:///./js/world/World.js","webpack:///./js/render/View.js","webpack:///./js/city/City.js","webpack:///./js/city/traffic/Traffic.js","webpack:///./js/utils/composition.js","webpack:///./node_modules/deepmerge/dist/es.js","webpack:///./js/city/traffic/car/physics/CarPhysics.js","webpack:///./js/utils/math/Vec2.js","webpack:///./js/utils/math/GMath.js","webpack:///./js/city/traffic/car/equipment/EquipmentBus.js","webpack:///./js/city/traffic/car/equipment/Camera.js","webpack:///./js/city/traffic/car/equipment/Navigator.js","webpack:///./js/city/traffic/car/equipment/auto-pilot/AutoPilot.js","webpack:///./js/city/traffic/car/equipment/auto-pilot/helper.js","webpack:///./js/connection/models/predicting.js","webpack:///./js/city/map/Map.js","webpack:///./js/render/Render.js","webpack:///./js/render/canvas-2d/Canvas2dRender.js","webpack:///./js/render/canvas-2d/VisualConfig.js","webpack:///./js/learning/Learning.js","webpack:///./js/learning/driving/Driving.js","webpack:///./js/learning/driving/Input.js","webpack:///./js/learning/stats/Stats.js","webpack:///./js/connection/models/learning.js","webpack:///./js/learning/stats/statsValidation.js","webpack:///./js/utils/storage.js","webpack:///./js/utils/loader.js","webpack:///./js/ui/UiLayer.js","webpack:///./js/ui/components/Table.js","webpack:///./js/ui/components/Canvas.js","webpack:///./js/ui/components/EventButton.js","webpack:///./js/ui/state.js"],"names":["ObjectsTypeMap","CAR","ROAD_MAP","DataLoadType","IMG","CarIdMap","VOLVO_XC_90","DEVICE_TYPES","CAMERA","NAVIGATOR","AUTOPILOT","ROAD_PHOTO_CONFIG","CAMERA_SIZE","IMAGE_TYPE","ROAD_IMAGE_SCALE","getCanvasHandlers","ctx","canvas","getContext","canvasWidth","width","canvasHeight","height","clear","clearRect","drawFillRect","x","y","w","h","fillStyle","beginPath","rect","fill","createTempCanvas","c","document","createElement","createCanvasForImageTransfer","size","imageType","scale","scaleSize","canvasForScale","covertImageDataToBase64","img","drawImage","b64str","toDataURL","image","split","type","initRequestAnimationFrameLoop","helperFn","ts","animateFn","window","requestAnimationFrame","stopAnimationFrameLoop","cancelAnimationFrame","id","slowDown","fn","delay","prevTime","newTime","Date","now","sendData","data","json","JSON","stringify","sendMessage","parseReceivedData","parse","isInit","createConnection","init","route","ws","WebSocket","onmessage","onMessage","event","msg","safeCheck","e","send","Error","connection","publishSubscriber","maintain","response","publish","on","subscribe","createPublishSubscriber","subscribersMap","subscribers","forEach","s","push","DefaultCarState","isVisible","initialPhysics","smoothSteer","safeSteer","config","maxSteer","maxSpeed","Car","world","state","setup","physicalInstance","equipmentBus","addDynamicEntry","onTick","update","autoPilot","getAutoPilot","autoPilotEnabled","drive","hasVisualView","getType","getCarPhysData","position","heading","getVisualData","cgToRear","halfWidth","getStatsData","velocity_c","steerAngle","inputs","speed","toFixed","left","right","throttle","brake","setDrivingInput","input","setInput","accessRoadCamera","getRoadCamera","createCar","car","uiActions","learning","stats","defineTableModel","tableHead","setTableRows","tableRows","cameraMonitor","setContext","context","el","setImageData","imageData","linkActionsCopy","newActionsObject","tableModel","rows","triggerUiEvent","onUiEvent","EVENTS","START_LEARN","STOP_LEARN","start","mountNode","city","render","learningDriving","stop","storage","setData","getInitialVisualData","Promise","all","load","then","startTime","worldConfig","TICK_TIME","createWorld","worldView","previousTs","isWorldStarted","listeners","dynamicEntries","staticEntries","delta","currentTs","l","length","removeListener","splice","entry","getDynamicEntries","addStaticEntry","getStaticEntries","getView","getView2D","roadCanvas","getElementById","helperCanvas","getRoadView","roadStage","getImageData","getHelperView","helperStage","highlightArea","ViewMap","view2D","CurrentView","createWorldView","City","traffic","map","createCity","DefaultTrafficState","cars","TRAFFIC_LIGHTS","Traffic","createCars","myCar","registrationNumber","model","addCar","createTraffic","mergeObjectStructures","destination","source","getInputState","ebrake","getCarConfig","opts","gravity","mass","inertiaScale","cgToFront","cgToFrontAxle","cgToRearAxle","cgHeight","wheelRadius","wheelWidth","tireGrip","lockGrip","clamp","engineForce","brakeForce","eBrakeForce","weightTransfer","cornerStiffnessFront","cornerStiffnessRear","airResist","rollResist","velocity","accel","accel_c","absVel","yawRate","steer","undefined","inertia","wheelBase","axleWeightRatioFront","axleWeightRatioRear","prototype","doPhysics","dt","dtHeading","cfg","sn","Math","sin","cs","cos","axleWeightFront","axleWeightRear","yawSpeedFront","yawSpeedRear","slipAngleFront","atan2","abs","sign","slipAngleRear","tireGripFront","tireGripRear","frictionForceFront_cy","frictionForceRear_cy","min","tractionForce_cx","tractionForce_cy","dragForce_cx","dragForce_cy","totalForce_cx","totalForce_cy","len","angularTorque","angularAccel","applySmoothSteer","steerInput","max","applySafeSteer","avel","dtms","m","createCarPhysics","Vec2","set","copy","v","sqrt","dot","det","rotate","r","angle","setLen","normalize","GMath","n","NaN","pmod","EquipmentBus","devices","accessCar","roadCamera","connectDevice","device","targetView","helperView","createEquipmentBus","addCarHeading","rSideBack","twoCgToRear","save","translate","fillRect","restore","Camera","rSideForward","tmpCanvas","highlightPhotoArea","takePhoto","putImageData","createCamera","createNavigator","getCurrentPosition","createAutoPilot","grab","decide","info","applyToInputs","photo","steering","STEERING_MAP","LEFT","RIGHT","NONE","canvasForImageTransfer","predictSteering","roadPhoto","waitForResponse","resolve","reject","console","log","predictSteeringByRoadPhoto","createMap","pt","RenderMap","render2D","createRender","visual","CurrentRender","dRender","sRender","renderDynamics","renderStatics","visualEntries","filter","renderEntry","getInitialDataConfig","EntriesRenders","visualModel","getEntryRenderMethod","visualState","visualData","RoadMap","src","SLOW_WORLD","CAR_POSITION","setupTestDriving","learningCar","learningStatsCollector","listenerID","visualize","Number","isInteger","setupLearningDriving","carStats","collect","ActionMap","startDriving","onKeyDown","code","onKeyUp","stopDriving","removeListeners","preventDefaultList","createInput","keyDownFn","includes","keyCode","preventDefault","addEventListener","keyUpFn","removeEventListener","TableModel","createStatsCollector","store","limit","manageStore","dataRecord","row","field","getSteeringLabel","prepareData","i","images","name","base64","sendLearningModelOneData","isStatsValid","loadDataModel","root","createStorage","dataToLoad","loadImage","path","onload","onerror","SIZE","onCanvasUpdate","oldAttributes","subState","view","actions","oldAttr","createUiLayer","actionsCopy","node","Table","head","className","column","value","Canvas","onCreate","onUpdate","EventButton","title","eventName","onClick"],"mappings":"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AAEA;;AAEA;;AAEA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW;AACX;AACA;AACA,0CAA0C;AAC1C;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA,qBAAqB,0BAA0B;AAC/C;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA,qBAAqB,0BAA0B;AAC/C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,qBAAqB,6BAA6B;AAClD;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;AACA,WAAW;AACX;AACA;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","file":"ai-city-simulation.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"AiCitySimulation\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"AiCitySimulation\"] = factory();\n\telse\n\t\troot[\"AiCitySimulation\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 11);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ea56276731e98c9653df","export const ObjectsTypeMap = {\n    CAR: 'Car',\n    ROAD_MAP: 'RoadMap'\n};\n\nexport const DataLoadType = {\n    IMG: 'img'\n};\n\nexport const CarIdMap = {\n    VOLVO_XC_90: 'VolvoXC90'\n};\n\nexport const DEVICE_TYPES = {\n    CAMERA: 'camera',\n    NAVIGATOR: 'navigator',\n    AUTOPILOT: 'autopilot'\n};\n\nexport const ROAD_PHOTO_CONFIG = {\n    CAMERA_SIZE: 144,\n    IMAGE_TYPE: 'image/jpeg',\n    ROAD_IMAGE_SCALE: 0.5\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/utils/constants.js","export const getCanvasHandlers = canvas => {\n    const ctx = canvas.getContext('2d');\n\n    const canvasWidth = canvas.width,\n        canvasHeight = canvas.height;\n\n    return {\n        canvas,\n        canvasWidth,\n        canvasHeight,\n        ctx,\n        clear() {\n            ctx.clearRect(0, 0, canvasWidth, canvasHeight);\n        }\n    };\n};\n\nexport const drawFillRect = (ctx, { x, y, w, h }) => {\n    ctx.fillStyle = 'rgba(255, 235, 59, 0.1)'; //TODO: config\n    ctx.beginPath();\n    ctx.rect(x, y, w, h);\n    ctx.fill();\n};\n\nexport const createTempCanvas = (w = 500, h = 500) => {\n    const c = document.createElement('canvas');\n    c.width = w;\n    c.height = h;\n\n    //document.body.appendChild(c)\n\n    return c;\n};\n\nexport const createCanvasForImageTransfer = ({\n    size,\n    imageType,\n    scale = 0.5\n}) => {\n    const scaleSize = size * scale;\n    const canvasForScale = createTempCanvas(scaleSize, scaleSize);\n    const { ctx, clear } = getCanvasHandlers(canvasForScale);\n\n    return {\n        covertImageDataToBase64(img) {\n            clear();\n            ctx.drawImage(img, 0, 0, scaleSize, scaleSize);\n\n            const b64str = canvasForScale.toDataURL(imageType);\n            return {\n                image: b64str.split('base64,')[1],\n                type: imageType.split('image/')[1]\n            };\n        }\n    };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/utils/canvas.js","export function h(name, attributes /*, ...rest*/) {\n  var node\n  var rest = []\n  var children = []\n  var length = arguments.length\n\n  while (length-- > 2) rest.push(arguments[length])\n\n  while (rest.length) {\n    if ((node = rest.pop()) && node.pop /* Array? */) {\n      for (length = node.length; length--; ) {\n        rest.push(node[length])\n      }\n    } else if (node != null && node !== true && node !== false) {\n      children.push(node)\n    }\n  }\n\n  return typeof name === \"function\"\n    ? name(attributes || {}, children)\n    : {\n        nodeName: name,\n        attributes: attributes || {},\n        children: children,\n        key: attributes && attributes.key\n      }\n}\n\nexport function app(state, actions, view, container) {\n  var renderLock\n  var invokeLaterStack = []\n  var rootElement = (container && container.children[0]) || null\n  var oldNode = rootElement && toVNode(rootElement, [].map)\n  var globalState = clone(state)\n  var wiredActions = clone(actions)\n\n  scheduleRender(wireStateToActions([], globalState, wiredActions))\n\n  return wiredActions\n\n  function toVNode(element, map) {\n    return {\n      nodeName: element.nodeName.toLowerCase(),\n      attributes: {},\n      children: map.call(element.childNodes, function(element) {\n        return element.nodeType === 3 // Node.TEXT_NODE\n          ? element.nodeValue\n          : toVNode(element, map)\n      })\n    }\n  }\n\n  function render() {\n    renderLock = !renderLock\n\n    var next = view(globalState, wiredActions)\n    if (container && !renderLock) {\n      rootElement = patch(container, rootElement, oldNode, (oldNode = next))\n    }\n\n    while ((next = invokeLaterStack.pop())) next()\n  }\n\n  function scheduleRender() {\n    if (!renderLock) {\n      renderLock = !renderLock\n      setTimeout(render)\n    }\n  }\n\n  function clone(target, source) {\n    var obj = {}\n\n    for (var i in target) obj[i] = target[i]\n    for (var i in source) obj[i] = source[i]\n\n    return obj\n  }\n\n  function set(path, value, source) {\n    var target = {}\n    if (path.length) {\n      target[path[0]] =\n        path.length > 1 ? set(path.slice(1), value, source[path[0]]) : value\n      return clone(source, target)\n    }\n    return value\n  }\n\n  function get(path, source) {\n    for (var i = 0; i < path.length; i++) {\n      source = source[path[i]]\n    }\n    return source\n  }\n\n  function wireStateToActions(path, state, actions) {\n    for (var key in actions) {\n      typeof actions[key] === \"function\"\n        ? (function(key, action) {\n            actions[key] = function(data) {\n              if (typeof (data = action(data)) === \"function\") {\n                data = data(get(path, globalState), actions)\n              }\n\n              if (\n                data &&\n                data !== (state = get(path, globalState)) &&\n                !data.then // Promise\n              ) {\n                scheduleRender(\n                  (globalState = set(path, clone(state, data), globalState))\n                )\n              }\n\n              return data\n            }\n          })(key, actions[key])\n        : wireStateToActions(\n            path.concat(key),\n            (state[key] = state[key] || {}),\n            (actions[key] = clone(actions[key]))\n          )\n    }\n  }\n\n  function getKey(node) {\n    return node ? node.key : null\n  }\n\n  function setElementProp(element, name, value, isSVG, oldValue) {\n    if (name === \"key\") {\n    } else if (name === \"style\") {\n      for (var i in clone(oldValue, value)) {\n        element[name][i] = value == null || value[i] == null ? \"\" : value[i]\n      }\n    } else {\n      if (typeof value === \"function\" || (name in element && !isSVG)) {\n        element[name] = value == null ? \"\" : value\n      } else if (value != null && value !== false) {\n        element.setAttribute(name, value)\n      }\n\n      if (value == null || value === false) {\n        element.removeAttribute(name)\n      }\n    }\n  }\n\n  function createElement(node, isSVG) {\n    var element =\n      typeof node === \"string\" || typeof node === \"number\"\n        ? document.createTextNode(node)\n        : (isSVG = isSVG || node.nodeName === \"svg\")\n          ? document.createElementNS(\n              \"http://www.w3.org/2000/svg\",\n              node.nodeName\n            )\n          : document.createElement(node.nodeName)\n\n    if (node.attributes) {\n      if (node.attributes.oncreate) {\n        invokeLaterStack.push(function() {\n          node.attributes.oncreate(element)\n        })\n      }\n\n      for (var i = 0; i < node.children.length; i++) {\n        element.appendChild(createElement(node.children[i], isSVG))\n      }\n\n      for (var name in node.attributes) {\n        setElementProp(element, name, node.attributes[name], isSVG)\n      }\n    }\n\n    return element\n  }\n\n  function updateElement(element, oldProps, attributes, isSVG) {\n    for (var name in clone(oldProps, attributes)) {\n      if (\n        attributes[name] !==\n        (name === \"value\" || name === \"checked\"\n          ? element[name]\n          : oldProps[name])\n      ) {\n        setElementProp(element, name, attributes[name], isSVG, oldProps[name])\n      }\n    }\n\n    if (attributes.onupdate) {\n      invokeLaterStack.push(function() {\n        attributes.onupdate(element, oldProps)\n      })\n    }\n  }\n\n  function removeChildren(element, node, attributes) {\n    if ((attributes = node.attributes)) {\n      for (var i = 0; i < node.children.length; i++) {\n        removeChildren(element.childNodes[i], node.children[i])\n      }\n\n      if (attributes.ondestroy) {\n        attributes.ondestroy(element)\n      }\n    }\n    return element\n  }\n\n  function removeElement(parent, element, node, cb) {\n    function done() {\n      parent.removeChild(removeChildren(element, node))\n    }\n\n    if (node.attributes && (cb = node.attributes.onremove)) {\n      cb(element, done)\n    } else {\n      done()\n    }\n  }\n\n  function patch(parent, element, oldNode, node, isSVG, nextSibling) {\n    if (node === oldNode) {\n    } else if (oldNode == null) {\n      element = parent.insertBefore(createElement(node, isSVG), element)\n    } else if (node.nodeName && node.nodeName === oldNode.nodeName) {\n      updateElement(\n        element,\n        oldNode.attributes,\n        node.attributes,\n        (isSVG = isSVG || node.nodeName === \"svg\")\n      )\n\n      var oldElements = []\n      var oldKeyed = {}\n      var newKeyed = {}\n\n      for (var i = 0; i < oldNode.children.length; i++) {\n        oldElements[i] = element.childNodes[i]\n\n        var oldChild = oldNode.children[i]\n        var oldKey = getKey(oldChild)\n\n        if (null != oldKey) {\n          oldKeyed[oldKey] = [oldElements[i], oldChild]\n        }\n      }\n\n      var i = 0\n      var j = 0\n\n      while (j < node.children.length) {\n        var oldChild = oldNode.children[i]\n        var newChild = node.children[j]\n\n        var oldKey = getKey(oldChild)\n        var newKey = getKey(newChild)\n\n        if (newKeyed[oldKey]) {\n          i++\n          continue\n        }\n\n        if (newKey == null) {\n          if (oldKey == null) {\n            patch(element, oldElements[i], oldChild, newChild, isSVG)\n            j++\n          }\n          i++\n        } else {\n          var recyledNode = oldKeyed[newKey] || []\n\n          if (oldKey === newKey) {\n            patch(element, recyledNode[0], recyledNode[1], newChild, isSVG)\n            i++\n          } else if (recyledNode[0]) {\n            patch(\n              element,\n              element.insertBefore(recyledNode[0], oldElements[i]),\n              recyledNode[1],\n              newChild,\n              isSVG\n            )\n          } else {\n            patch(element, oldElements[i], null, newChild, isSVG)\n          }\n\n          j++\n          newKeyed[newKey] = newChild\n        }\n      }\n\n      while (i < oldNode.children.length) {\n        var oldChild = oldNode.children[i]\n        if (getKey(oldChild) == null) {\n          removeElement(element, oldElements[i], oldChild)\n        }\n        i++\n      }\n\n      for (var i in oldKeyed) {\n        if (!newKeyed[oldKeyed[i][1].key]) {\n          removeElement(element, oldKeyed[i][0], oldKeyed[i][1])\n        }\n      }\n    } else if (node.nodeName === oldNode.nodeName) {\n      element.nodeValue = node\n    } else {\n      element = parent.insertBefore(\n        createElement(node, isSVG),\n        (nextSibling = element)\n      )\n      removeElement(parent, nextSibling, oldNode)\n    }\n    return element\n  }\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/hyperapp/src/index.js\n// module id = 2\n// module chunks = 0","export const initRequestAnimationFrameLoop = animateFn => {\n    function helperFn(ts) {\n        animateFn(ts);\n        window.requestAnimationFrame(helperFn);\n    }\n\n    window.requestAnimationFrame(helperFn);\n};\n\nconst stopAnimationFrameLoop = id => window.cancelAnimationFrame(id);\n\nexport const slowDown = (fn, delay = 250, prevTime = 0) => () => {\n    const newTime = Date.now();\n\n    if (newTime - prevTime > delay) {\n        fn();\n\n        prevTime = newTime;\n    }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/utils/animation.js","import connection from './connection';\n\nexport const sendData = (type, data) => {\n    const json = JSON.stringify({ type, data });\n    return connection.sendMessage(json);\n};\n\nexport const parseReceivedData = data => {\n    return JSON.parse(data);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/connection/adapter.js","import { maintain } from './maintainer';\n\nlet isInit = false;\n\nconst createConnection = () => ({\n    init(route = 'ws://127.0.0.1:8765/') {\n        this.ws = new WebSocket(route);\n        this.ws.onmessage = event => this.onMessage(event.data);\n\n        isInit = true;\n    },\n\n    onMessage(msg) {\n        try {\n            this.safeCheck();\n            maintain(msg);\n        } catch (e) {}\n    },\n\n    sendMessage(msg) {\n        try {\n            this.safeCheck();\n            this.ws.send(msg);\n        } catch (e) {}\n    },\n\n    safeCheck() {\n        if (!isInit) throw new Error('connection is not init');\n    }\n});\n\nconst connection = createConnection();\nexport default connection;\n\n\n\n// WEBPACK FOOTER //\n// ./js/connection/connection.js","import { createPublishSubscriber } from '../utils/events';\nimport { parseReceivedData } from './adapter';\n\nconst publishSubscriber = createPublishSubscriber();\n\nexport const maintain = response => {\n    const { type, data } = parseReceivedData(response);\n    publishSubscriber.publish(type, data);\n};\n\nexport const on = (event, fn) => {\n    publishSubscriber.subscribe(event, fn);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/connection/maintainer.js","export const createPublishSubscriber = () => {\n    const subscribersMap = {};\n\n    return {\n        publish(event, data) {\n            const subscribers = subscribersMap[event] || [];\n            subscribers.forEach(s => s(data));\n        },\n\n        subscribe(event, fn) {\n            if (!subscribersMap[event]) {\n                subscribersMap[event] = [];\n            }\n\n            subscribersMap[event].push(fn);\n        }\n    };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/utils/events.js","import { ObjectsTypeMap } from '../../../utils/constants';\nimport { slowDown } from '../../../utils/animation';\nimport { mergeObjectStructures } from '../../../utils/composition';\nimport { createCarPhysics } from './physics/CarPhysics';\nimport { createEquipmentBus } from './equipment/EquipmentBus';\n\nconst DefaultCarState = {\n    type: ObjectsTypeMap.CAR,\n    isVisible: true,\n    initialPhysics: {\n        x: 50,\n        y: 50,\n        smoothSteer: true,\n        safeSteer: true,\n        config: { maxSteer: 0.5, maxSpeed: 10 }\n    }\n};\n\nconst Car = (world, state) => ({\n    setup() {\n        this.physicalInstance = createCarPhysics(state.initialPhysics);\n        this.equipmentBus = createEquipmentBus(world, this);\n\n        world.addDynamicEntry(this);\n        world.onTick(ts => this.physicalInstance.update(ts, 2, 0.6));\n\n        const autoPilot = this.equipmentBus.getAutoPilot();\n        world.onTick(\n            slowDown(() => {\n                if (state.autoPilotEnabled) {\n                    autoPilot.drive();\n                }\n            }, 50)\n        );\n    },\n\n    hasVisualView() {\n        return state.isVisible;\n    },\n\n    getType() {\n        return state.type;\n    },\n\n    getCarPhysData() {\n        const { position, heading } = this.physicalInstance;\n\n        return {\n            position,\n            heading\n        };\n    },\n\n    getVisualData() {\n        const scale = 12;\n        const { config, position, heading } = this.physicalInstance;\n\n        return {\n            cgToRear: scale * config.cgToRear,\n            halfWidth: scale * config.halfWidth,\n\n            position,\n            heading\n        };\n    },\n\n    getStatsData() {\n        const { velocity_c, steerAngle, inputs } = this.physicalInstance;\n\n        return {\n            speed: (velocity_c.x / 2 * 3.6).toFixed(1),\n            steerAngle: steerAngle.toFixed(3),\n\n            left: inputs.left,\n            right: inputs.right,\n            throttle: inputs.throttle,\n            brake: inputs.brake\n        };\n    },\n\n    setDrivingInput(input) {\n        return this.physicalInstance.setInput(input);\n    },\n\n    accessRoadCamera() {\n        return this.equipmentBus.getRoadCamera();\n    }\n});\n\nexport const createCar = (world, state = {}) => {\n    const car = Car(world, {\n        ...mergeObjectStructures(DefaultCarState, state)\n    });\n\n    car.setup();\n\n    return car;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/city/traffic/car/Car.js","export let uiActions = {\n    learning: {\n        stats: {\n            defineTableModel: tableHead => state => ({ tableHead }),\n            setTableRows: tableRows => state => ({ tableRows })\n        },\n        cameraMonitor: {\n            setContext: el => state => ({ context: el.getContext('2d') }),\n            setImageData: imageData => state => ({ imageData })\n        }\n    }\n};\n\nexport const linkActionsCopy = newActionsObject =>\n    (uiActions = newActionsObject);\n\nexport const defineTableModel = tableModel =>\n    uiActions.learning.stats.defineTableModel(tableModel);\n\nexport const setTableRows = rows => uiActions.learning.stats.setTableRows(rows);\n\nexport const setImageData = imageData =>\n    uiActions.learning.cameraMonitor.setImageData(imageData);\n\n\n\n// WEBPACK FOOTER //\n// ./js/ui/actions.js","import { createPublishSubscriber } from '../utils/events';\n\nconst publishSubscriber = createPublishSubscriber();\n\nexport const triggerUiEvent = (type, data = {}) => {\n    publishSubscriber.publish(type, data);\n};\n\nexport const onUiEvent = (event, fn) => {\n    publishSubscriber.subscribe(event, fn);\n};\n\nexport const EVENTS = {\n    START_LEARN: 'START_LEARN',\n    STOP_LEARN: 'STOP_LEARN'\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/ui/events.js","import world from './world/World';\nimport connection from './connection/connection';\n\nimport { createCity } from './city/City';\nimport { createRender } from './render/Render';\nimport { setupLearningDriving, setupTestDriving } from './learning/Learning';\n\nimport { createStorage } from './utils/storage';\nimport { createUiLayer } from './ui/UiLayer';\nimport { onUiEvent, EVENTS } from './ui/events';\n\nexport default {\n    start(mountNode) {\n        createUiLayer(mountNode);\n        connection.init(); //TODO: uncomment when need socket\n\n        const city = createCity(world);\n        const render = createRender(world);\n\n        //TODO: moving this line breaks car rendering\n        //also, it should init only if it's learning mode\n\n        //const learningDriving = setupTestDriving(world);\n        const learningDriving = setupLearningDriving(world);\n\n        onUiEvent(EVENTS.START_LEARN, () => learningDriving.start());\n        onUiEvent(EVENTS.STOP_LEARN, () => learningDriving.stop());\n\n        const storage = createStorage();\n        storage.setData(render.getInitialVisualData());\n\n        Promise.all([storage.load()]).then(() => {\n            city.init();\n\n            world.startTime();\n            render.start();\n        });\n    }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/index.js","import { initRequestAnimationFrameLoop } from '../utils/animation';\nimport { createWorldView } from '../render/View';\n\nconst worldConfig = {\n    TICK_TIME: 10 //5000\n};\n\nexport const createWorld = config => {\n    const worldView = createWorldView();\n\n    let previousTs = 0,\n        isWorldStarted = false;\n\n    const listeners = [];\n\n    const dynamicEntries = [];\n    const staticEntries = [];\n\n    return {\n        startTime() {\n            if (isWorldStarted) return;\n            isWorldStarted = true;\n\n            initRequestAnimationFrameLoop(currentTs => {\n                const delta = currentTs - previousTs;\n\n                if (delta >= config.TICK_TIME) {\n                    listeners.forEach(l => l(delta));\n                    previousTs = currentTs;\n                }\n            });\n        },\n\n        onTick(fn) {\n            listeners.push(fn);\n            return listeners.length - 1;\n        },\n\n        removeListener(id) {\n            listeners.splice(id, 1);\n        },\n\n        addDynamicEntry(entry) {\n            dynamicEntries.push(entry);\n        },\n\n        getDynamicEntries() {\n            return dynamicEntries;\n        },\n\n        addStaticEntry(entry) {\n            staticEntries.push(entry);\n        },\n\n        getStaticEntries() {\n            return staticEntries;\n        },\n\n        getView() {\n            return worldView;\n        }\n    };\n};\n\nconst world = createWorld(worldConfig);\nexport default world;\n\n\n\n// WEBPACK FOOTER //\n// ./js/world/World.js","import { getCanvasHandlers, drawFillRect } from '../utils/canvas';\n\nconst getView2D = () => {\n    //TODO: IDs to config\n    const roadCanvas = document.getElementById('static-stage');\n    const helperCanvas = document.getElementById('helper-stage');\n\n    return {\n        getRoadView() {\n            const roadStage = getCanvasHandlers(roadCanvas);\n\n            return {\n                getImageData(x, y, w, h) {\n                    return roadStage.ctx.getImageData(x, y, w, h);\n                }\n            };\n        },\n\n        getHelperView() {\n            const helperStage = getCanvasHandlers(helperCanvas);\n\n            return {\n                highlightArea(x, y, w, h) {\n                    helperStage.clear();\n                    drawFillRect(helperStage.ctx, { x, y, w, h });\n                }\n            };\n        }\n    };\n};\n\nexport const ViewMap = {\n    view2D: getView2D()\n};\n\n//TODO: config\nconst CurrentView = ViewMap.view2D;\n\nexport const createWorldView = () => CurrentView;\n\n\n\n// WEBPACK FOOTER //\n// ./js/render/View.js","import { createTraffic } from './traffic/Traffic';\nimport { createMap } from './map/Map';\n\nconst City = (world, state) => ({\n    init() {\n        //TODO: now is learning\n        const traffic = createTraffic(world);\n        //traffic.init();\n        const map = createMap(world);\n    }\n});\n\nexport const createCity = (world, state = {}) => {\n    return City(world, {\n        ...state\n    });\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/city/City.js","import { createCar } from './car/Car';\n\nconst DefaultTrafficState = {\n    cars: [],\n    TRAFFIC_LIGHTS: true\n};\n\nconst Traffic = (world, state) => ({\n    init() {\n        this.createCars();\n    },\n\n    createCars() {\n        const myCar = createCar(world, {\n            registrationNumber: '1',\n            model: 'Volvo XC90'\n        });\n\n        this.addCar(myCar);\n    },\n\n    addCar(car) {\n        state.cars.push(car);\n    }\n});\n\nexport const createTraffic = (world, state = {}) => {\n    return Traffic(world, {\n        ...DefaultTrafficState,\n        ...state\n    });\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/city/traffic/Traffic.js","import merge from 'deepmerge';\nexport const mergeObjectStructures = (destination, source) =>\n    merge(destination, source);\n\n\n\n// WEBPACK FOOTER //\n// ./js/utils/composition.js","var isMergeableObject = function isMergeableObject(value) {\n\treturn isNonNullObject(value)\n\t\t&& !isSpecial(value)\n};\n\nfunction isNonNullObject(value) {\n\treturn !!value && typeof value === 'object'\n}\n\nfunction isSpecial(value) {\n\tvar stringValue = Object.prototype.toString.call(value);\n\n\treturn stringValue === '[object RegExp]'\n\t\t|| stringValue === '[object Date]'\n\t\t|| isReactElement(value)\n}\n\n// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25\nvar canUseSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;\n\nfunction isReactElement(value) {\n\treturn value.$$typeof === REACT_ELEMENT_TYPE\n}\n\nfunction emptyTarget(val) {\n\treturn Array.isArray(val) ? [] : {}\n}\n\nfunction cloneUnlessOtherwiseSpecified(value, optionsArgument) {\n\tvar clone = !optionsArgument || optionsArgument.clone !== false;\n\n\treturn (clone && isMergeableObject(value))\n\t\t? deepmerge(emptyTarget(value), value, optionsArgument)\n\t\t: value\n}\n\nfunction defaultArrayMerge(target, source, optionsArgument) {\n\treturn target.concat(source).map(function(element) {\n\t\treturn cloneUnlessOtherwiseSpecified(element, optionsArgument)\n\t})\n}\n\nfunction mergeObject(target, source, optionsArgument) {\n\tvar destination = {};\n\tif (isMergeableObject(target)) {\n\t\tObject.keys(target).forEach(function(key) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(target[key], optionsArgument);\n\t\t});\n\t}\n\tObject.keys(source).forEach(function(key) {\n\t\tif (!isMergeableObject(source[key]) || !target[key]) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(source[key], optionsArgument);\n\t\t} else {\n\t\t\tdestination[key] = deepmerge(target[key], source[key], optionsArgument);\n\t\t}\n\t});\n\treturn destination\n}\n\nfunction deepmerge(target, source, optionsArgument) {\n\tvar sourceIsArray = Array.isArray(source);\n\tvar targetIsArray = Array.isArray(target);\n\tvar options = optionsArgument || { arrayMerge: defaultArrayMerge };\n\tvar sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;\n\n\tif (!sourceAndTargetTypesMatch) {\n\t\treturn cloneUnlessOtherwiseSpecified(source, optionsArgument)\n\t} else if (sourceIsArray) {\n\t\tvar arrayMerge = options.arrayMerge || defaultArrayMerge;\n\t\treturn arrayMerge(target, source, optionsArgument)\n\t} else {\n\t\treturn mergeObject(target, source, optionsArgument)\n\t}\n}\n\ndeepmerge.all = function deepmergeAll(array, optionsArgument) {\n\tif (!Array.isArray(array)) {\n\t\tthrow new Error('first argument should be an array')\n\t}\n\n\treturn array.reduce(function(prev, next) {\n\t\treturn deepmerge(prev, next, optionsArgument)\n\t}, {})\n};\n\nvar deepmerge_1 = deepmerge;\n\nexport default deepmerge_1;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/deepmerge/dist/es.js\n// module id = 17\n// module chunks = 0","/**\n * Code is heavily based on source from\n * https://github.com/spacejack/carphysics2d\n */\n\nimport { Vec2 } from '../../../../utils/math/Vec2';\nimport { GMath } from '../../../../utils/math/GMath';\n\nconst getInputState = () => ({\n    left: 0,\n    right: 0,\n    throttle: 0,\n    brake: 0,\n    ebrake: 0\n});\n\n/**\n *  Car setup params and magic constants.\n */\nexport const getCarConfig = (opts = {}) => {\n    const state = {};\n\n    //  Defaults approximate a lightweight sports-sedan.\n    state.gravity = opts.gravity || 9.81; // m/s^2\n    state.mass = opts.mass || 1200.0; // kg\n    state.inertiaScale = opts.inertiaScale || 1.0; // Multiply by mass for inertia\n    state.halfWidth = opts.halfWidth || 0.8; // Centre to side of chassis (metres)\n    state.cgToFront = opts.cgToFront || 2.0; // Centre of gravity to front of chassis (metres)\n    state.cgToRear = opts.cgToRear || 2.0; // Centre of gravity to rear of chassis\n    state.cgToFrontAxle = opts.cgToFrontAxle || 1.25; // Centre gravity to front axle\n    state.cgToRearAxle = opts.cgToRearAxle || 1.25; // Centre gravity to rear axle\n    state.cgHeight = opts.cgHeight || 0.55; // Centre gravity height\n    state.wheelRadius = opts.wheelRadius || 0.3; // Includes tire (also represents height of axle)\n    state.wheelWidth = opts.wheelWidth || 0.2; // Used for render only\n    state.tireGrip = opts.tireGrip || 2.0; // How much grip tires have\n    state.lockGrip =\n        typeof opts.lockGrip === 'number'\n            ? GMath.clamp(opts.lockGrip, 0.01, 1.0)\n            : 0.7; // % of grip available when wheel is locked\n    state.engineForce = opts.engineForce || 8000.0;\n    state.brakeForce = opts.brakeForce || 4000.0;\n    state.eBrakeForce = opts.eBrakeForce || state.brakeForce / 2.5;\n    state.weightTransfer =\n        typeof opts.weightTransfer === 'number' ? opts.weightTransfer : 0.2; // How much weight is transferred during acceleration/braking\n    state.maxSteer = opts.maxSteer || 0.6; // Maximum steering angle in radians\n    state.cornerStiffnessFront = opts.cornerStiffnessFront || 5.0;\n    state.cornerStiffnessRear = opts.cornerStiffnessRear || 5.2;\n    state.airResist = typeof opts.airResist === 'number' ? opts.airResist : 2.5; // air resistance (* vel)\n    state.rollResist =\n        typeof opts.rollResist === 'number' ? opts.rollResist : 8.0; // rolling resistance force (* vel)\n\n    return state;\n};\n\nfunction Car(opts = {}, scale) {\n    //  State of inputs\n    this.inputs = getInputState();\n\n    //  Car state variables\n    this.heading = opts.heading || 0.0; // angle car is pointed at (radians)\n    this.position = new Vec2(opts.x, opts.y); // metres in world coords\n    this.velocity = new Vec2(); // m/s in world coords\n    this.velocity_c = new Vec2(); // m/s in local car coords (x is forward y is sideways)\n    this.accel = new Vec2(); // acceleration in world coords\n    this.accel_c = new Vec2(); // acceleration in local car coords\n    this.absVel = 0.0; // absolute velocity m/s\n    this.yawRate = 0.0; // angular velocity in radians\n    this.steer = 0.0; // amount of steering input (-1.0..1.0)\n    this.steerAngle = 0.0; // actual front wheel steer angle (-maxSteer..maxSteer)\n\n    //  Use input smoothing (on by default)\n    this.smoothSteer =\n        opts.smoothSteer === undefined ? true : !!opts.smoothSteer;\n    //  Use safe steering (angle limited by speed)\n    this.safeSteer = opts.safeSteer === undefined ? true : !!opts.safeSteer;\n\n    //  Setup car configuration\n    this.config = getCarConfig(opts.config);\n\n    // Re-calculate these\n    this.inertia = this.config.mass * this.config.inertiaScale;\n    this.wheelBase = this.config.cgToFrontAxle + this.config.cgToRearAxle;\n    this.axleWeightRatioFront = this.config.cgToRearAxle / this.wheelBase; // % car weight on the front axle\n    this.axleWeightRatioRear = this.config.cgToFrontAxle / this.wheelBase; // % car weight on the rear axle\n}\n\n/**\n *  @param dt Floating-point Delta Time in seconds\n */\nCar.prototype.doPhysics = function(dt, dtHeading) {\n    // Shorthand\n    let cfg = this.config;\n\n    // Pre-calc heading vector\n    let sn = Math.sin(this.heading);\n    let cs = Math.cos(this.heading);\n\n    // Get velocity in local car coordinates\n    this.velocity_c.x = cs * this.velocity.x + sn * this.velocity.y;\n    this.velocity_c.y = cs * this.velocity.y - sn * this.velocity.x;\n\n    // Weight on axles based on centre of gravity and weight shift due to forward/reverse acceleration\n    let axleWeightFront =\n        cfg.mass *\n        (this.axleWeightRatioFront * cfg.gravity -\n            cfg.weightTransfer *\n                this.accel_c.x *\n                cfg.cgHeight /\n                this.wheelBase);\n    let axleWeightRear =\n        cfg.mass *\n        (this.axleWeightRatioRear * cfg.gravity +\n            cfg.weightTransfer *\n                this.accel_c.x *\n                cfg.cgHeight /\n                this.wheelBase);\n\n    // Resulting velocity of the wheels as result of the yaw rate of the car body.\n    // v = yawrate * r where r is distance from axle to CG and yawRate (angular velocity) in rad/s.\n    let yawSpeedFront = cfg.cgToFrontAxle * this.yawRate;\n    let yawSpeedRear = -cfg.cgToRearAxle * this.yawRate;\n\n    // Calculate slip angles for front and rear wheels (a.k.a. alpha)\n    let slipAngleFront =\n        Math.atan2(\n            this.velocity_c.y + yawSpeedFront,\n            Math.abs(this.velocity_c.x)\n        ) -\n        GMath.sign(this.velocity_c.x) * this.steerAngle;\n    let slipAngleRear = Math.atan2(\n        this.velocity_c.y + yawSpeedRear,\n        Math.abs(this.velocity_c.x)\n    );\n\n    let tireGripFront = cfg.tireGrip;\n    let tireGripRear =\n        cfg.tireGrip * (1.0 - this.inputs.ebrake * (1.0 - cfg.lockGrip)); // reduce rear grip when ebrake is on\n\n    let frictionForceFront_cy =\n        GMath.clamp(\n            -cfg.cornerStiffnessFront * slipAngleFront,\n            -tireGripFront,\n            tireGripFront\n        ) * axleWeightFront;\n    let frictionForceRear_cy =\n        GMath.clamp(\n            -cfg.cornerStiffnessRear * slipAngleRear,\n            -tireGripRear,\n            tireGripRear\n        ) * axleWeightRear;\n\n    //  Get amount of brake/throttle from our inputs\n    let brake = Math.min(\n        this.inputs.brake * cfg.brakeForce +\n            this.inputs.ebrake * cfg.eBrakeForce,\n        cfg.brakeForce\n    );\n    let throttle = this.inputs.throttle * cfg.engineForce;\n\n    //  Resulting force in local car coordinates.\n    //  This is implemented as a RWD car only.\n    let tractionForce_cx = throttle - brake * GMath.sign(this.velocity_c.x);\n    let tractionForce_cy = 0;\n\n    let dragForce_cx =\n        -cfg.rollResist * this.velocity_c.x -\n        cfg.airResist * this.velocity_c.x * Math.abs(this.velocity_c.x);\n    let dragForce_cy =\n        -cfg.rollResist * this.velocity_c.y -\n        cfg.airResist * this.velocity_c.y * Math.abs(this.velocity_c.y);\n\n    // total force in car coordinates\n    let totalForce_cx = dragForce_cx + tractionForce_cx;\n    let totalForce_cy =\n        dragForce_cy +\n        tractionForce_cy +\n        Math.cos(this.steerAngle) * frictionForceFront_cy +\n        frictionForceRear_cy;\n\n    // acceleration along car axes\n    this.accel_c.x = totalForce_cx / cfg.mass; // forward/reverse accel\n    this.accel_c.y = totalForce_cy / cfg.mass; // sideways accel\n\n    // acceleration in world coordinates\n    this.accel.x = cs * this.accel_c.x - sn * this.accel_c.y;\n    this.accel.y = sn * this.accel_c.x + cs * this.accel_c.y;\n\n    // update velocity\n    this.velocity.x += this.accel.x * dt;\n    this.velocity.y += this.accel.y * dt;\n\n    this.absVel = this.velocity.len();\n\n    // calculate rotational forces\n    let angularTorque =\n        (frictionForceFront_cy + tractionForce_cy) * cfg.cgToFrontAxle -\n        frictionForceRear_cy * cfg.cgToRearAxle;\n\n    //  Sim gets unstable at very slow speeds, so just stop the car\n    if (Math.abs(this.absVel) < 0.5 && !throttle) {\n        this.velocity.x = this.velocity.y = this.absVel = 0;\n        angularTorque = this.yawRate = 0;\n    }\n\n    let angularAccel = angularTorque / this.inertia;\n\n    this.yawRate += angularAccel * dtHeading;\n    this.heading += this.yawRate * dtHeading;\n\n    //  finally we can update position\n    this.position.x += this.velocity.x * dt;\n    this.position.y += this.velocity.y * dt;\n};\n\n/**\n *  Smooth Steering\n *  Apply maximum steering angle change velocity.\n */\nCar.prototype.applySmoothSteer = function(steerInput, dt) {\n    let steer = 0;\n\n    if (Math.abs(steerInput) > 0.001) {\n        //  Move toward steering input\n        steer = GMath.clamp(this.steer + steerInput * dt * 2.0, -1.0, 1.0); // -inp.right, inp.left);\n    } else {\n        //  No steer input - move toward centre (0)\n        if (this.steer > 0) {\n            steer = Math.max(this.steer - dt * 1.0, 0);\n        } else if (this.steer < 0) {\n            steer = Math.min(this.steer + dt * 1.0, 0);\n        }\n    }\n\n    return steer;\n};\n\n/**\n *  Safe Steering\n *  Limit the steering angle by the speed of the car.\n *  Prevents oversteer at expense of more understeer.\n */\nCar.prototype.applySafeSteer = function(steerInput) {\n    let avel = Math.min(this.absVel, 250.0); // m/s\n    return steerInput * (1.0 - avel / 280.0);\n};\n\n/**\n *  @param dtms Delta Time in milliseconds\n */\nCar.prototype.update = function(dtms, m, h) {\n    let dt = m * dtms / 1000.0; // delta T in seconds\n    let dtHeading = h * dtms / 1000.0; // delta T in seconds\n\n    this.throttle = this.inputs.throttle;\n    this.brake = this.inputs.brake;\n\n    let steerInput = this.inputs.left - this.inputs.right;\n\n    //  Perform filtering on steering...\n    if (this.smoothSteer)\n        this.steer = this.applySmoothSteer(steerInput, dtHeading);\n    else this.steer = steerInput;\n\n    if (this.safeSteer) this.steer = this.applySafeSteer(this.steer);\n\n    //  Now set the actual steering angle\n    this.steerAngle = this.steer * this.config.maxSteer;\n\n    //\n    //  Now that the inputs have been filtered and we have our throttle,\n    //  brake and steering values, perform the car physics update...\n    //\n    this.doPhysics(dt, dtHeading);\n};\n\nCar.prototype.setInput = function(inputs = {}) {\n    this.inputs = { ...this.inputs, ...inputs };\n};\n\nexport const createCarPhysics = (opts, scale) => new Car(opts, scale);\n\n\n\n// WEBPACK FOOTER //\n// ./js/city/traffic/car/physics/CarPhysics.js","/**\n * Code is heavily based on source from\n * https://github.com/spacejack/carphysics2d\n */\n\nexport const Vec2 = function(x, y) {\n    this.x = x || 0.0;\n    this.y = y || 0.0;\n};\n\nVec2.prototype = {\n    set(x, y) {\n        this.x = x;\n        this.y = y;\n    },\n\n    copy(v) {\n        this.x = v.x;\n        this.y = v.y;\n\n        return this;\n    },\n\n    len() {\n        return Math.sqrt(this.x * this.x + this.y * this.y);\n    },\n\n    dot(v) {\n        return this.x * v.x + this.y * v.y;\n    },\n\n    det(v) {\n        return this.x * v.y - this.y * v.x;\n    },\n\n    rotate(r) {\n        let x = this.x,\n            y = this.y,\n            c = Math.cos(r),\n            s = Math.sin(r);\n        this.x = x * c - y * s;\n        this.y = x * s + y * c;\n    },\n\n    angle() {\n        return Math.atan2(this.y, this.x);\n    },\n\n    setLen(l) {\n        let s = this.len();\n\n        if (s > 0.0) {\n            s = l / s;\n            this.x *= s;\n            this.y *= s;\n        } else {\n            this.x = l;\n            this.y = 0.0;\n        }\n    },\n\n    normalize() {\n        this.setLen(1.0);\n    }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/utils/math/Vec2.js","/**\n * Code is heavily based on source from\n * https://github.com/spacejack/carphysics2d\n */\n\nexport const GMath = {\n    sign(n) {\n        return typeof n === 'number'\n            ? n ? (n < 0 ? -1 : 1) : n === n ? 0 : NaN\n            : NaN;\n    },\n\n    clamp(n, min, max) {\n        return Math.min(Math.max(n, min), max);\n    },\n\n    pmod(n, m) {\n        return (n % m + m) % m;\n    }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/utils/math/GMath.js","import { createCamera } from './Camera';\nimport { createNavigator } from './Navigator';\nimport { createAutoPilot } from './auto-pilot/AutoPilot';\n\nconst EquipmentBus = (world, car, devices = {}) => ({\n    accessCar() {\n        return car;\n    },\n\n    getAutoPilot() {\n        return devices.autoPilot;\n    },\n\n    getRoadCamera() {\n        return devices.roadCamera;\n    },\n\n    connectDevice({ type, device }) {\n        devices[type] = device;\n    },\n\n    setup() {\n        const equipmentBus = this;\n        const worldView = world.getView();\n\n        this.connectDevice({\n            type: 'roadCamera',\n            device: createCamera({\n                equipmentBus,\n                targetView: worldView.getRoadView(),\n                helperView: worldView.getHelperView()\n            })\n        });\n\n        this.connectDevice({\n            type: 'navigator',\n            device: createNavigator({\n                equipmentBus\n            })\n        });\n\n        this.connectDevice({\n            type: 'autoPilot',\n            device: createAutoPilot({\n                equipmentBus\n            })\n        });\n    }\n});\n\nexport const createEquipmentBus = (world, car) => {\n    const equipmentBus = EquipmentBus(world, car);\n\n    equipmentBus.setup();\n\n    return equipmentBus;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/city/traffic/car/equipment/EquipmentBus.js","import { DEVICE_TYPES } from '../../../../utils/constants';\nimport { createTempCanvas, getCanvasHandlers } from '../../../../utils/canvas';\n\nconst addCarHeading = (\n    ctx,\n    rSideBack,\n    heading,\n    cgToRear,\n    halfWidth,\n    twoCgToRear\n) => {\n    ctx.save();\n    ctx.translate(rSideBack, rSideBack);\n    ctx.rotate(heading);\n    ctx.fillRect(-cgToRear, -halfWidth, twoCgToRear, cgToRear);\n    ctx.restore();\n};\n\nconst Camera = ({ targetView, helperView, car }) => {\n    const { cgToRear, halfWidth, position } = car.getVisualData();\n\n    const twoCgToRear = 2 * cgToRear,\n        rSideBack = 3 * cgToRear,\n        rSideForward = 2 * rSideBack;\n\n    const tmpCanvas = createTempCanvas(rSideForward, rSideForward);\n    const { ctx, clear } = getCanvasHandlers(tmpCanvas);\n\n    //TODO: theme\n    ctx.fillStyle = 'red';\n\n    return {\n        highlightPhotoArea() {\n            const { x, y } = position;\n\n            return helperView.highlightArea(\n                x - rSideBack,\n                y - rSideBack,\n                rSideForward,\n                rSideForward\n            );\n        },\n\n        takePhoto() {\n            const { x, y } = position;\n            const { heading } = car.getCarPhysData();\n\n            const imageData = targetView.getImageData(\n                x - rSideBack,\n                y - rSideBack,\n                rSideForward,\n                rSideForward\n            );\n\n            clear();\n            ctx.putImageData(imageData, 0, 0);\n\n            //draw car rectangle\n            addCarHeading(\n                ctx,\n                rSideBack,\n                heading,\n                cgToRear,\n                halfWidth,\n                twoCgToRear\n            );\n\n            return ctx.canvas;\n        }\n    };\n};\n\nexport const createCamera = ({ targetView, helperView, equipmentBus }) => {\n    return Camera({ targetView, helperView, car: equipmentBus.accessCar() });\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/city/traffic/car/equipment/Camera.js","import { DEVICE_TYPES } from '../../../../utils/constants';\n\nexport const createNavigator = () => {\n    return {\n        type: DEVICE_TYPES.NAVIGATOR,\n\n        getCurrentPosition() {\n            return {};\n        }\n    };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/city/traffic/car/equipment/Navigator.js","import { DEVICE_TYPES } from '../../../../../utils/constants';\nimport { predictSteering } from './helper';\n\nexport const createAutoPilot = ({ equipmentBus }) => {\n    const state = {};\n\n    return {\n        type: DEVICE_TYPES.AUTOPILOT,\n\n        drive() {\n            this.grab()\n                .then(info => this.decide(info))\n                .then(inputs => this.applyToInputs(inputs));\n        },\n\n        grab() {\n            const roadCamera = equipmentBus.getRoadCamera();\n\n            const photo = roadCamera.takePhoto();\n            return predictSteering(photo).then(steering => ({ steering }));\n        },\n\n        decide(info) {\n            const steering = info.steering;\n\n            const STEERING_MAP = {\n                LEFT: 'L',\n                RIGHT: 'R',\n                NONE: 'N'\n            };\n\n            return {\n                right: steering === STEERING_MAP.RIGHT ? 1 : 0,\n                left: steering === STEERING_MAP.LEFT ? 1 : 0,\n            };\n        },\n\n        applyToInputs(inputs) {\n            equipmentBus.accessCar().setDrivingInput(inputs);\n        }\n    };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/city/traffic/car/equipment/auto-pilot/AutoPilot.js","import { createCanvasForImageTransfer } from '../../../../../utils/canvas';\nimport { ROAD_PHOTO_CONFIG } from '../../../../../utils/constants';\nimport { predictSteeringByRoadPhoto } from '../../../../../connection/models/predicting';\n\nconst canvasForImageTransfer = createCanvasForImageTransfer({\n    size: ROAD_PHOTO_CONFIG.CAMERA_SIZE,\n    imageType: ROAD_PHOTO_CONFIG.IMAGE_TYPE,\n    scale: ROAD_PHOTO_CONFIG.ROAD_IMAGE_SCALE\n});\n\nexport const predictSteering = roadPhoto => {\n    const data = canvasForImageTransfer.covertImageDataToBase64(roadPhoto);\n\n    return predictSteeringByRoadPhoto(data.image);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/city/traffic/car/equipment/auto-pilot/helper.js","import { sendData } from '../adapter';\nimport { on } from '../maintainer';\n\nlet waitForResponse = {};\n\non('was_predicted_by_model_one', ({ steering, id }) => {\n    if (id === waitForResponse.id) {\n        return waitForResponse.resolve(steering);\n    }\n\n    waitForResponse.reject();\n    console.log('MISMATCH')\n});\n\nexport const predictSteeringByRoadPhoto = image => {\n    const id = Date.now();\n\n    sendData('predict_by_model_one', {\n        id,\n        image\n    });\n\n    return new Promise((resolve, reject) => {\n        waitForResponse = {resolve, reject, id};\n    });\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/connection/models/predicting.js","import { ObjectsTypeMap } from '../../utils/constants';\n\nexport const createMap = world => {\n    const map = {\n        hasVisualView() {\n            return true;\n        },\n        getVisualData() {\n            return {\n                pt: {\n                    x: 0,\n                    y: 0\n                }\n            };\n        },\n        getType() {\n            return ObjectsTypeMap.ROAD_MAP;\n        }\n    };\n\n    world.addStaticEntry(map);\n\n    return map;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/city/map/Map.js","/**\n *\n * It should be easy to switch to 3d render, etc\n */\n\nimport setup2dRender from './canvas-2d/Canvas2dRender';\nimport setup2dVisual from './canvas-2d/VisualConfig';\n\nexport const RenderMap = {\n    render2D: {\n        createRender(id, visual) {\n            const canvas = document.getElementById(id);\n            return setup2dRender(canvas, visual);\n        },\n\n        visual() {\n            return setup2dVisual();\n        }\n    }\n};\n\n//TODO: config\nconst CurrentRender = RenderMap.render2D;\n\nexport const createRender = world => {\n    const visual = CurrentRender.visual();\n    //TODO: IDs move to config\n    const dRender = CurrentRender.createRender('dynamic-stage', visual);\n    const sRender = CurrentRender.createRender('static-stage', visual);\n\n    return {\n        start() {\n            this.renderDynamics();\n            this.renderStatics();\n        },\n\n        renderDynamics() {\n            const visualEntries = world\n                .getDynamicEntries()\n                .filter(e => e.hasVisualView && e.hasVisualView()); //TODO: think how it will be dynamically updated if some of entries get view\n\n            world.onTick(() => {\n                dRender.clear();\n                visualEntries.forEach(e =>\n                    dRender.renderEntry(e.getType(), e.getVisualData())\n                );\n            });\n        },\n\n        renderStatics() {\n            const visualEntries = world\n                .getStaticEntries()\n                .filter(e => e.hasVisualView && e.hasVisualView());\n\n            visualEntries.forEach(e =>\n                sRender.renderEntry(e.getType(), e.getVisualData())\n            );\n        },\n\n        getInitialVisualData() {\n            return visual.getInitialDataConfig();\n        }\n    };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/render/Render.js","import { getCanvasHandlers } from '../../utils/canvas';\nimport { ObjectsTypeMap } from '../../utils/constants';\n\nexport const EntriesRenders = {\n    [ObjectsTypeMap.CAR](ctx, state, visualModel) {\n        ctx.save();\n\n        ctx.translate(state.position.x, state.position.y);\n        ctx.rotate(state.heading);\n\n        ctx.drawImage(visualModel.data, -state.cgToRear, -state.halfWidth);\n\n        ctx.restore();\n    },\n\n    [ObjectsTypeMap.ROAD_MAP](ctx, state, visualModel) {\n        ctx.drawImage(visualModel.data, state.pt.x, state.pt.y);\n    }\n};\n\nexport const getEntryRenderMethod = type => {\n    if (!EntriesRenders[type]) {\n        return () => {\n            //TODO: add logger\n            console.log('Opps, got lost by type' + type);\n        };\n    }\n\n    return EntriesRenders[type];\n};\n\nexport default (canvas, visual) => {\n    const { ctx, clear } = getCanvasHandlers(canvas);\n\n    return {\n        clear,\n\n        renderEntry(type, visualState) {\n            const render = getEntryRenderMethod(type),\n                visualData = visual.getVisualData();\n\n            render(ctx, visualState, visualData[type]);\n        }\n    };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/render/canvas-2d/Canvas2dRender.js","const RoadMap = {\n    id: 'RoadMap',\n    src: '/image/map.png',\n    type: 'img'\n};\n\nconst Car = {\n    id: 'Car',\n    src: '/image/car.png',\n    type: 'img'\n};\n\nexport default () => {\n    return {\n        getInitialDataConfig() {\n            return [RoadMap, Car];\n        },\n\n        getVisualData() {\n            return {\n                RoadMap,\n                Car\n            };\n        }\n    };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/render/canvas-2d/VisualConfig.js","import { slowDown } from '../utils/animation';\nimport { startDriving } from './driving/Driving';\n\nimport { createCar } from '../city/traffic/car/Car';\nimport { createStatsCollector } from './stats/Stats';\nimport { isStatsValid } from './stats/statsValidation';\n\nconst SLOW_WORLD = 50;\n\nconst CAR_POSITION = { x: 200, y: 25 };\n\nexport const setupTestDriving = world => {\n    const learningCar = createCar(world, {\n        autoPilotEnabled: true,\n        initialPhysics: { ...CAR_POSITION }\n    });\n\n    const roadCamera = learningCar.accessRoadCamera();\n    const learningStatsCollector = createStatsCollector();\n\n    startDriving(learningCar);\n\n    return {\n        start() {\n            this.listenerID = world.onTick(\n                slowDown(() => {\n                    learningStatsCollector.visualize(\n                        learningCar.getStatsData(),\n                        roadCamera.takePhoto()\n                    );\n                }, 10)\n            );\n        },\n\n        stop() {\n            Number.isInteger(this.listenerID) &&\n                world.removeListener(this.listenerID);\n        }\n    };\n};\n\nexport const setupLearningDriving = world => {\n    const learningCar = createCar(world, {\n        initialPhysics: { ...CAR_POSITION }\n    });\n\n    const roadCamera = learningCar.accessRoadCamera();\n    const learningStatsCollector = createStatsCollector();\n\n    startDriving(learningCar);\n\n    return {\n        start() {\n            this.listenerID = world.onTick(\n                slowDown(() => {\n                    roadCamera.highlightPhotoArea();\n\n                    const carStats = learningCar.getStatsData();\n                    if (isStatsValid(carStats)) {\n                        console.log('collect...');\n                        learningStatsCollector.collect({\n                            carStats,\n                            roadPhoto: roadCamera.takePhoto()\n                        });\n                    }\n                }, SLOW_WORLD)\n            );\n        },\n\n        stop() {\n            Number.isInteger(this.listenerID) &&\n                world.removeListener(this.listenerID);\n        }\n    };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/learning/Learning.js","import input from './Input';\n\nconst ActionMap = {\n    39: 'left',\n    37: 'right',\n    38: 'throttle',\n    40: 'brake',\n    32: 'ebrake'\n};\n\nexport const startDriving = car => {\n    input.onKeyDown(code => {\n        if (ActionMap[code]) car.setDrivingInput({ [ActionMap[code]]: 1 });\n    });\n\n    input.onKeyUp(code => {\n        if (ActionMap[code]) car.setDrivingInput({ [ActionMap[code]]: 0 });\n    });\n};\n\nexport const stopDriving = () => {\n    input.removeListeners();\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/learning/driving/Driving.js","const preventDefaultList = [32, 37, 38, 39, 40];\nexport const createInput = (document = document) => {\n    return {\n        onKeyDown(fn) {\n            this.keyDownFn = e => {\n                preventDefaultList.includes(e.keyCode) && e.preventDefault();\n                fn(e.keyCode);\n            };\n            document.addEventListener('keydown', this.keyDownFn);\n        },\n\n        onKeyUp(fn) {\n            this.keyUpFn = e => fn(e.keyCode);\n            document.addEventListener('keyup', this.keyUpFn);\n        },\n\n        removeListeners() {\n            this.keyDownFn &&\n                document.removeEventListener('keydown', this.keyDownFn);\n            this.keyUpFn && document.removeEventListener('keyup', this.keyUpFn);\n        }\n    };\n};\n\nconst input = createInput(document);\nexport default input;\n\n\n\n// WEBPACK FOOTER //\n// ./js/learning/driving/Input.js","import { ROAD_PHOTO_CONFIG } from '../../utils/constants';\nimport { createCanvasForImageTransfer } from '../../utils/canvas';\n\nimport { sendLearningModelOneData } from '../../connection/models/learning';\nimport { defineTableModel, setTableRows, setImageData } from '../../ui/actions';\n\nconst TableModel = [\n    'speed',\n    'steerAngle',\n    'left',\n    'right',\n    'throttle',\n    'brake'\n];\n\nexport const createStatsCollector = () => {\n    const canvasForImageTransfer = createCanvasForImageTransfer({\n        size: ROAD_PHOTO_CONFIG.CAMERA_SIZE,\n        imageType: ROAD_PHOTO_CONFIG.IMAGE_TYPE,\n        scale: ROAD_PHOTO_CONFIG.ROAD_IMAGE_SCALE\n    });\n\n    const store = {\n        limit: 10,\n        data: []\n    };\n\n    defineTableModel(TableModel);\n\n    return {\n        manageStore(dataRecord) {\n            if (store.data.length >= store.limit) {\n                sendLearningModelOneData(store.data);\n                store.data = [];\n            }\n\n            store.data.push(dataRecord);\n        },\n\n        visualize(carStats, photo) {\n            const row = TableModel.map(field => carStats[field]);\n            setTableRows([row]);\n            setImageData(photo);\n        },\n\n        collect({ carStats, roadPhoto }) {\n            this.manageStore({\n                id: Date.now(),\n                carStats,\n                roadPhoto: {\n                    ...canvasForImageTransfer.covertImageDataToBase64(roadPhoto)\n                }\n            });\n\n            this.visualize(carStats, roadPhoto);\n        }\n    };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/learning/stats/Stats.js","import { sendData } from '../adapter';\n\nconst STEERING_MAP = {\n    LEFT: 'L',\n    RIGHT: 'R',\n    NONE: 'N'\n};\n\nconst getSteeringLabel = carStats => {\n    if (carStats.left) return STEERING_MAP.LEFT;\n    if (carStats.right) return STEERING_MAP.RIGHT;\n    return STEERING_MAP.NONE;\n};\n\nconst prepareData = data => ({\n    stats: data.map(({ id, carStats }) => ({\n        i:id,\n        id,\n        steering: getSteeringLabel(carStats)\n    })),\n    images: data.map(({ id, roadPhoto }) => ({\n        name: id + '.' + roadPhoto.type,\n        base64: roadPhoto.image\n    }))\n});\n\nexport const sendLearningModelOneData = data => {\n    return sendData('learning_model_one_data', prepareData(data));\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/connection/models/learning.js","export const isStatsValid = ({ left, right }) => {\n    return true;//left || right;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/learning/stats/statsValidation.js","import { loadImage } from './loader';\nimport { DataLoadType } from './constants';\n\nconst loadDataModel = (root, model) => {\n    if (model.data) return Promise.resolve(model.data);\n\n    let load = null;\n    switch (model.type) {\n        case DataLoadType.IMG:\n            load = loadImage(root + model.src);\n            break;\n    }\n\n    if (load) {\n        return load.then(r => {\n            model.data = r;\n            return model;\n        });\n    }\n\n    return Promise.reject({ data: model, msg: 'Model type unknown' });\n};\n\nexport const createStorage = ({ root = 'resource' } = {}) => {\n    let dataToLoad = [];\n\n    return {\n        setData(data) {\n            dataToLoad = [...dataToLoad, ...data];\n        },\n\n        load() {\n            return Promise.all(\n                dataToLoad.filter(m => !m.data).map(m => loadDataModel(root, m))\n            );\n        }\n    };\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/utils/storage.js","export const loadImage = path =>\n    new Promise((resolve, reject) => {\n        const img = document.createElement('img');\n        img.src = path;\n        img.onload = () => resolve(img);\n        img.onerror = reject;\n    });\n\n\n\n// WEBPACK FOOTER //\n// ./js/utils/loader.js","import { h, app } from 'hyperapp';\nimport { Table } from './components/Table';\nimport { Canvas, putImageData, clearRect } from './components/Canvas';\nimport { EventButton } from './components/EventButton';\nimport { state } from './state';\nimport { uiActions, linkActionsCopy } from './actions';\nimport { triggerUiEvent, EVENTS } from './events';\nimport { ROAD_PHOTO_CONFIG } from '../utils/constants';\n\nconst SIZE = ROAD_PHOTO_CONFIG.CAMERA_SIZE;\n\nconst onCanvasUpdate = (el, oldAttributes, state) => {\n    const subState = state.learning.cameraMonitor;\n    if (\n        oldAttributes.imageData !== subState.imageData &&\n        subState.context &&\n        subState.imageData\n    ) {\n        clearRect(subState.context, SIZE);\n        putImageData(subState.context, subState.imageData);\n    }\n};\n\nconst view = (state, actions) => (\n    <div className=\"ui-controls\">\n        <Table\n            className=\"stats\"\n            head={state.learning.stats.tableHead}\n            rows={state.learning.stats.tableRows}\n        />\n        <Canvas\n            width={SIZE}\n            height={SIZE}\n            className=\"camera-monitor\"\n            onCreate={el => actions.learning.cameraMonitor.setContext(el)}\n            onUpdate={(el, oldAttr) => onCanvasUpdate(el, oldAttr, state)}\n        />\n        <div className=\"buttons\">\n            <EventButton\n                title=\"start learn\"\n                eventName={EVENTS.START_LEARN}\n                onClick={triggerUiEvent}\n            />\n            <EventButton\n                title=\"stop learn\"\n                eventName={EVENTS.STOP_LEARN}\n                onClick={triggerUiEvent}\n            />\n        </div>\n    </div>\n);\n\nexport const createUiLayer = node => {\n    const actionsCopy = app(state, uiActions, view, node);\n    linkActionsCopy(actionsCopy);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/ui/UiLayer.js","import { h } from 'hyperapp';\n\nexport const Table = ({ head, rows, className }) => (\n    <table className={className}>\n        <thead>{head.map(column => <th>{column}</th>)}</thead>\n\n        <tbody>\n            {rows.map(row => <tr>{row.map(value => <td>{value}</td>)}</tr>)}\n        </tbody>\n    </table>\n);\n\n\n\n// WEBPACK FOOTER //\n// ./js/ui/components/Table.js","import { h } from 'hyperapp';\n\nexport const Canvas = ({\n    imageData,\n    width,\n    height,\n    className,\n    onCreate,\n    onUpdate\n}) => (\n    <canvas\n        oncreate={onCreate}\n        onupdate={onUpdate}\n        className={className}\n        width={width}\n        height={height}\n    />\n);\n\nexport const clearRect = (ctx, size) => {\n    ctx.clearRect(0, 0, size, size);\n};\n\nexport const putImageData = (ctx, imageData) => {\n    ctx.drawImage(imageData, 0, 0);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/ui/components/Canvas.js","import { h } from 'hyperapp';\n\nexport const EventButton = ({ title, eventName, onClick }) => (\n    <button onclick={data => onClick(eventName, data)} title={eventName}>\n        {title}\n    </button>\n);\n\n\n\n// WEBPACK FOOTER //\n// ./js/ui/components/EventButton.js","export const state = {\n    learning: {\n        stats: {\n            tableHead: [],\n            tableRows: []\n        },\n        cameraMonitor: {\n            context: null,\n            imageData: null\n        }\n    }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/ui/state.js"],"sourceRoot":""}